<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">

<link rel="stylesheet" href="/static/mdb.min.css">
<link rel="stylesheet" href="/static/fontawesome-free-5.15.3-web/css/all.min.css">
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/mdb.min.js"></script>
<link href="/static/css/addons/datatables.min.css" rel="stylesheet">
<!-- DataTables JS -->
<script src="/static/js/addons/datatables.min.js" type="text/javascript"></script>

<!-- DataTables Select CSS -->
<link href="/static/css/addons/datatables-select.min.css" rel="stylesheet">
<!-- DataTables Select JS -->
<script src="/static/js/addons/datatables-select.min.js" type="text/javascript"></script>
<style>
.dataTables_length select{
    width:50px!important
}
</style>

</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: #e3f2fd;">
<a class="navbar-brand" href="/">
    <img src="/static/logo.png" width="225" height="60" alt="">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item active">
        <a class="nav-link" href="/hakkimizda">Hakkımızda</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/iletisim">İletişim</a>
      </li>
      {% if request.user.is_authenticated %}
            <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Hoşgeldiniz, {{request.user}}
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="/raporlar">Raporlar</a>
          <a class="dropdown-item" href="/logout">Çıkış Yap</a>
        </div>
      </li>
      {% else %}
        <li class="nav-item">
        <a class="nav-link" href="/register">Üye Ol</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/login">Giriş Yap</a>
      </li>
      {% endif %}
      
    </ul>
  </div>
</nav>
<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-md-12 mb-3 mt-3">
        <div class="d-flex">
        
            <div class="">
            <form method="post" class="d-flex" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="form-group d-flex">
<input type="file" class="form-control" id="customFile" name="excelFile" />
                    <button class="btn btn-outline-dark w-50 ml-3">Rapor Oluştur</button>
                  </div>
                
            </form>
            </div>
            </div>
            
        </div>
        <div class="col-md-12 mb-3">
        <div class="d-flex">
            <input type="text" class="w-25 form-control" id="rapor_saha_no" placeholder="Getirilecek Raporların Saha No'sunu Giriniz.">
            <button class="btn btn-outline-dark raporlari_getir ml-3">Raporları Getir</button>
        </div>
            
            <br>
            <select class="custom-select w-50 " id="rapor_select" onfocus='this.size=10;' onblur='this.size=1;' onchange='this.size=1; this.blur();'>
            
                
            </select>
            <button class="btn btn-outline-dark rapor_getir ml-3">Raporu Getir</button>
        </div>
        <div class="col-md-12">
        
    
            <table id="dt-basic" class="table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                  <tr>
                    <th class="th-sm">Saha No - Saha Kod
                    </th>
                    <th class="th-sm">Ref 1
                    </th>
                    <th class="th-sm">Ref 2
                    </th>
                    <th class="th-sm">Ref 3
                    </th>
                    <th class="th-sm">Ref 4
                    </th>
                    <th class="th-sm">Ref 5
                    </th>
                    <th class="th-sm">Ref 6
                    </th>
                    <th class="th-sm">Ref Grup
                    </th>
                    <th class="th-sm">Sonuc
                    </th>
                    <th class="th-sm">Kategori</th>
                    <th class="th-sm">Sorgu No</th>
                    <th class="th-sm">Açıklama</th>
                    <th class="th-sm">Kaydet</th>
                  </tr>
                </thead>
                <tbody class="tbody">
                    {% for girdi in data %}
<tr>
                    <td>{{girdi.saha_no}} - {{girdi.saha_kod}}</td>
                    <td>{{girdi.ref_1}}</td>
                    <td>{{girdi.ref_2}}</td>
                    <td>{{girdi.ref_3}}</td>
                    <td>{{girdi.ref_4}}</td>
                    <td>{{girdi.ref_5}}</td>
                    <td>{{girdi.ref_6}}</td>
                    <td>{{girdi.ref_grup}}</td>
                    <td>{{girdi.sonuc}}</td>
                    <td>{{girdi.kategori}}</td>
                    <td>{{girdi.sorgu_no}}</td>
                    <td><input class="form-control" value="{{girdi.aciklama}}"></td>
                    <td><button type="button" class="btn btn-outline-dark save" data-id="{{girdi.id}}">Kaydet</button></td>
                  </tr>
{% endfor %}
                </tbody>

              </table>
              </div>
        </div>
    </div>
</div>


    <script>
    function fillTable(saha_no, rapor_id){
        var option_value = 50
        var girdiler_query_string = ""
        girdiler_query_string = "?rapor_id=" + rapor_id
        $.get("/rapor_getir" + girdiler_query_string, (res) => {
           $(".tbody").html("")
           $(".tbody").html(res)
          /*     $('#dt-basic').dataTable({
        scrollX:true,
        scrollY:true,
        destroy:true,
        });
        $(".dataTables_length select option").each(function(el){
            console.log("deneme")
            $(this).val(option_value)
            $(this).text(option_value)
            option_value += 100
        })*/
        $(".save").click(function(){
            var girdi_id = $(this)[0].dataset.id
            var aciklama = $(this).parent().parent().find("input").val()
            console.log(aciklama)
            $.get("/updateAciklama?girdi_id=" + girdi_id + "&aciklama=" + aciklama, (res) => {
                console.log(res)
            })
        })
        
    })
    }
    $(".save").click(function(){
            var girdi_id = $(this)[0].dataset.id
            var aciklama = $(this).parent().parent().find("input").val()
            console.log(aciklama)
            $.get("/updateAciklama?girdi_id=" + girdi_id + "&aciklama=" + aciklama, (res) => {
                console.log(res)
            })
        })
    $(".run").click(() => {

       var saha_no = $("#new_rapor_select").val()
       fillTable(saha_no, rapor_id="")
       
    })
    $(".raporlari_getir").click(() => {
        var saha_no = $("#rapor_saha_no").val()
        $.get("/raporlari_getir?saha_no=" + saha_no, (res, text) => {
            $("#rapor_select").html(res)
        })
    })
    $(".rapor_getir").click(() => {
        var rapor_id = $("#rapor_select").val()
        fillTable(saha_no="", rapor_id=rapor_id)
    })
</script>
</body>
</html>